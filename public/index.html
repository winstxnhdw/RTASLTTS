<!DOCTYPE html>

<html lang="en">
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="index.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.1/gsap.min.js"></script>

    <div id="result"></div>

    <script type="text/javascript" charset="utf-8">
      const result_element = document.getElementById('result')
      let previous_result = ''
      result_element.style.opacity = '1'

      const reduce_opacity = () => {
        const opacity = Number(result_element.style.opacity)
        result_element.style.opacity = (opacity - 0.1).toString()

        if (opacity <= 0.0) {
          result_element.replaceChildren()
          result_element.style.opacity = '0'
        }
      }

      setInterval(async () => {
        const result = await fetch('http://localhost:5000/')

        if (result.status !== 200) return
        const result_text = await result.text()
        if (result_text === '') {
          reduce_opacity()
          return
        }

        if (result_text !== previous_result) {
          previous_result = result
          const word = document.createElement('span')
          word.className = 'word'
          word.innerHTML = result_text
          result_element.appendChild(word)
          result_element.style.opacity = '1'
          gsap.fromTo(
            word,
            {
              autoAlpha: 0,
              filter: 'blur(10px)',
              y: 40
            },
            {
              autoAlpha: 1,
              filter: 'blur(0px)',
              y: 0,
              ease: 'Expo.easeOut',
              duration: 0.5
            }
          )
        } else {
          reduce_opacity()
        }
      }, 1000)
    </script>
  </head>
</html>
